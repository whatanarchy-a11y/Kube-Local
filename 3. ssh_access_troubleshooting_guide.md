# SSH 접속 가이드 (VirtualBox Ubuntu 서버 VM: 복붙/운영 최적 루트)

> 목표: Ubuntu 서버 VM(cp1 등)에 **SSH로 접속**해서 Windows 터미널에서 명령을 **복붙**하며 운영합니다.
> “GUI 없는 서버 VM”에서는 이 방식이 가장 빠르고 안정적입니다.

- 날짜: 2026-01-10

---

## 1) cp1(Ubuntu)에서 SSH 서버 설치/활성화

cp1에서:
```sh
sudo apt update
sudo apt install -y openssh-server
sudo systemctl enable --now ssh
sudo systemctl status ssh --no-pager -l
```

정상 예시:
```text
Active: active (running)
```

---

## 2) (선택) UFW가 켜져 있으면 22/tcp 허용

cp1에서:
```sh
sudo ufw status
```

`Status: active`라면:
```sh
sudo ufw allow 22/tcp
```

---

## 3) cp1에서 22번 포트 리스닝 확인

```sh
sudo ss -lntp | grep ':22' || echo "22 not listening"
```

정상 예시(형태):
```text
LISTEN ... :22 ... users:(("sshd",pid=...,fd=...))
```
---
### 서버 재 설치 후 ssh 접속 중 오류

```sh
PS C:\Windows\system32> ssh ubuntu@192.168.56.10
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
The fingerprint for the ED25519 key sent by the remote host is
SHA256:eX2RzRgJQDVRWBaaWWxGexVLnMsyGlD/NmAZ+x8t6Vs.
Please contact your system administrator.
Add correct host key in C:\\Users\\TJ/.ssh/known_hosts to get rid of this message.
Offending ECDSA key in C:\\Users\\TJ/.ssh/known_hosts:3
Host key for 192.168.56.10 has changed and you have requested strict checking.
Host key verification failed.
```
---
```sh
PS C:\Windows\system32> ssh-keygen -R 192.168.56.10
# Host 192.168.56.10 found: line 1
# Host 192.168.56.10 found: line 2
# Host 192.168.56.10 found: line 3
C:\Users\TJ/.ssh/known_hosts updated.
Original contents retained as C:\Users\TJ/.ssh/known_hosts.old
PS C:\Windows\system32> ssh ubuntu@192.168.56.10
The authenticity of host '192.168.56.10 (192.168.56.10)' can't be established.
ED25519 key fingerprint is SHA256:eX2RzRgJQDVRWBaaWWxGexVLnMsyGlD/NmAZ+x8t6Vs.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.56.10' (ED25519) to the list of known hosts.
ubuntu@192.168.56.10's password:
Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-164-generic x86_64)
```

---

## 4) Windows(PowerShell)에서 접속

```powershell
ssh ubuntu@192.168.56.10
```

- Host-Only IP가 아직 확정 전이라면, 현재 VM의 Host-Only IP(예: `192.168.56.101`)로 접속합니다.
- 최초 접속 시 fingerprint 확인이 나오면 `yes` 입력.

---

## 5) 자주 발생하는 에러 & 해결

### 5-1) `Connection refused`

의미: 네트워크가 아니라, **SSH 서버(sshd)가 안 떠 있음**이 99%입니다.

해결:
- 1) SSH 설치/실행 (섹션 1)
- 2) 22번 리슨 확인 (섹션 3)

---

### 5-2) `sshd -t` 단계에서 실패 / `no hostkeys available`

상태에서 이런 로그가 나오면:
- `ExecStartPre=/usr/sbin/sshd -t (status=1/FAILURE)`
- `sshd: no hostkeys available -- exiting`

✅ 해결(호스트키 생성 → 재시작):
```sh
sudo ssh-keygen -A
sudo systemctl restart ssh
sudo systemctl status ssh --no-pager -l
```

---

### 5-3) 설정 파일 문법 오류(희귀)

```sh
sudo sshd -t
echo $?
```

에러가 뜨면 설정 원복(안전 루트):
```sh
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak.$(date +%Y%m%d%H%M%S)
sudo dpkg-reconfigure openssh-server
sudo systemctl restart ssh
```

---

## 6) (Desktop 설치 VM인 경우) Guest Additions로 클립보드/드래그&드롭

Ubuntu Desktop VM이라면:
- VirtualBox 상단 메뉴 → **Devices → Insert Guest Additions CD image…**
- 게스트에서 설치 후 재부팅

> 서버(Text) VM에서는 일반적으로 **SSH가 가장 효율적**입니다.

---

## 7) 점검용 “3줄 세트”

문제 생겼을 때 cp1에서 아래 3줄 출력만 있으면 원인 분리가 거의 끝납니다.

```sh
ip -br a
sudo systemctl status ssh --no-pager -l
sudo ss -lntp | grep ':22' || echo "22 not listening"
```

---

## 참고(원본 단서)

원문에는 `Connection refused` → sshd 미기동, 그리고 `no hostkeys available` → `ssh-keygen -A`로 해결한 흐름이 포함되어 있습니다.
