# Kubernetes: Label(레이블) vs Annotation(어노테이션- 주석) 정리 + 예시

쿠버네티스에서 **Label** 과 **Annotation** 은 둘 다 `metadata`에 붙이는 “메타데이터”이지만, **목적이 완전히 다릅니다**.

---

## 1) 한 줄 정의

- **Label(레이블)**: 리소스를 **분류/선택(Selector)** 하기 위한 “검색용 태그”  
  → `Service`, `Deployment selector`, `kubectl -l`, `NetworkPolicy` 등이 **라벨로 대상 선택**을 합니다.

- **Annotation(어노테이션)**: 리소스에 붙이는 **부가 설명/설정/툴용 메타데이터**  
  → **선택(Selector)에는 쓰지 않음**. Ingress Controller, Prometheus, cert-manager 등 외부 도구가 읽는 **설정값**으로 많이 씁니다.

---

## 2) Label 예시 (선택/필터링에 사용)

### 2-1) Deployment & Service에서 라벨/셀렉터 매칭
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
  labels:
    app: nginx
    tier: web
spec:
  selector:
    matchLabels:
      app: nginx     # 이 라벨을 가진 파드를 관리
  template:
    metadata:
      labels:
        app: nginx   # 파드에 실제로 붙는 라벨
        tier: web
    spec:
      containers:
      - name: nginx
        image: nginx:1.27-alpine
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-svc
spec:
  selector:
    app: nginx       # app=nginx 라벨이 있는 파드로 트래픽 보냄
  ports:
  - port: 80
    targetPort: 80
```

### 2-2) 라벨로 조회/필터
```sh
kubectl get pods -l app=nginx
kubectl get pods -l 'app=nginx,tier=web'
kubectl get all  -l app=nginx
```

### 2-3) 라벨 추가/수정
```sh
kubectl label pod mypod env=dev
kubectl label pod mypod env=prod --overwrite
```

---

## 3) Annotation 예시 (설정/설명/툴 연동에 사용)

### 3-1) Ingress에서 Traefik 설정(예: entrypoints 지정)
(k3s 기본 Traefik 환경에서 자주 봄)
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nginx-ing
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web
spec:
  rules:
  - host: nginx.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: nginx-svc
            port:
              number: 80
```

### 3-2) Prometheus 스크레이프 설정(대표 예시)
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: app
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8080"
spec:
  containers:
  - name: app
    image: myapp:latest
```

### 3-3) cert-manager(인증서 발급) 관련 어노테이션(대표)
```yaml
metadata:
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
```

### 3-4) annotation 추가/수정
```sh
kubectl annotate pod mypod note="hello"
kubectl annotate pod mypod note="changed" --overwrite
```

---

## 4) 핵심 차이 요약

| 구분 | Label | Annotation |
|---|---|---|
| 목적 | **선택/분류** (Selector에 사용) | **설명/설정/도구 연동** |
| 크기/자유도 | 보통 짧고 규칙적 | 길고 자유로운 값 가능 |
| 사용처 | Service selector, Deployment selector, 필터링 | Ingress/모니터링/컨트롤러 옵션, 문서/추적 정보 |
| 변경 시 영향 | 트래픽 라우팅/대상 변경 가능(중요) | 대부분 기능 설정 변경(도구가 읽을 때만 영향) |

---

## 5) 실무에서 흔한 라벨 권장 패턴
쿠버네티스 권장 라벨(많이 씀):
- `app.kubernetes.io/name`
- `app.kubernetes.io/instance`
- `app.kubernetes.io/version`
- `app.kubernetes.io/part-of`
- `app.kubernetes.io/component`
- `app.kubernetes.io/managed-by` (helm 등)

예:
```yaml
metadata:
  labels:
    app.kubernetes.io/name: nginx
    app.kubernetes.io/instance: nginx-prod
    app.kubernetes.io/component: web
    app.kubernetes.io/managed-by: Helm
```

---

## 한 줄 결론
- **Label** = “대상을 고르는 태그(Selector에 사용)”
- **Annotation** = “설정/설명 메모(도구가 읽는 옵션)”
