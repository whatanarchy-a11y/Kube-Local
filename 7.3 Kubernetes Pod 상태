# Kubernetes Pod 상태/오류(예: CrashLoopBackOff) 정리

> 목적: `kubectl get pods`의 STATUS(또는 `describe`의 Events)에 나오는 **대표적인 Pod 오류/상태**를  
> “무슨 뜻인지 / 왜 생기는지 / 무엇을 먼저 봐야 하는지” 중심으로 빠르게 정리합니다.

---

## 0) 문제 분석 기본 3종 세트(가장 중요)

문제 Pod를 발견하면, 아래 3개로 **대부분 원인이 바로 나옵니다.**

```bash
kubectl get pod -n <ns> <pod> -o wide
kubectl describe pod -n <ns> <pod>      # Events 필수 확인
kubectl logs -n <ns> <pod> --previous   # CrashLoopBackOff면 특히 중요
```

---

## 1) 스케줄/배치 단계에서 막히는 상태

### ⏳ Pending
**의미**
- Pod 오브젝트는 생성되었지만, **노드에 배치(스케줄)되지 않았거나** 준비 작업(볼륨/이미지 등)이 끝나지 않음

**대표 원인**
- 노드가 NotReady / 스케줄 가능한 노드 부족
- taints/tolerations 불일치, nodeSelector/affinity 불일치
- 요청 리소스(cpu/mem)가 너무 큼
- PVC 바인딩 실패(스토리지 미준비)

**무엇을 먼저 볼까**
```bash
kubectl describe pod -n <ns> <pod>   # Events에 “왜 Pending인지”가 거의 다 나옴
kubectl get nodes
```

### 🛑 Unschedulable (주로 Events 메시지로 표시)
**의미**
- 스케줄러가 배치 가능한 노드를 못 찾음

**대표 메시지 예**
- `0/3 nodes are available: ...`

**무엇을 먼저 볼까**
```bash
kubectl describe pod -n <ns> <pod>   # Events
kubectl describe node <node>         # Taints/리소스 확인
```

---

## 2) 이미지(레지스트리) 문제

### 🧲 ErrImagePull / ImagePullBackOff
**의미**
- 이미지를 당기기(pull) 실패. `ImagePullBackOff`는 **재시도 백오프 상태**.

**대표 원인**
- 이미지 이름/태그 오타
- private registry 인증 필요(imagePullSecrets 없음)
- 노드에서 레지스트리 접근 불가(DNS/방화벽/프록시)
- 레지스트리 장애

**무엇을 먼저 볼까**
```bash
kubectl describe pod -n <ns> <pod>   # Events에 pull 실패 이유
kubectl get events -n <ns> --sort-by=.lastTimestamp | tail -n 30
```

---

## 3) “실행되긴 하는데 계속 죽는” 계열

### 🔁 CrashLoopBackOff
**의미**
- 컨테이너가 **실행 → 곧바로 종료**를 반복  
- kubelet이 재시작 간격을 점점 늘리는(back-off) 상태

**대표 원인**
- 앱 프로세스가 즉시 종료(설정 파일 없음, env 누락, 포트 바인딩 실패)
- `command/args`(엔트리포인트) 설정 오류
- 앱 크래시(예외, 세그폴트)
- `livenessProbe`가 계속 실패 → kubelet이 죽였다가 재시작

**무엇을 먼저 볼까(우선순위)**
```bash
kubectl logs -n <ns> <pod> --previous   # 직전 크래시 로그(핵심)
kubectl describe pod -n <ns> <pod>      # Exit Code / Reason / Events
```

### ❌ Error
**의미**
- 컨테이너가 종료(Terminated)되었고 실패로 판단됨  
- CrashLoop처럼 반복이 아직 뚜렷하지 않거나 1회성 실패일 수 있음

**무엇을 먼저 볼까**
```bash
kubectl describe pod -n <ns> <pod>   # State: Terminated / Exit Code / Reason
kubectl logs -n <ns> <pod>
```

### ⚠️ OOMKilled
**의미**
- 메모리 부족으로 커널이 컨테이너 프로세스를 강제 종료

**대표 특징**
- `Reason: OOMKilled`, `Exit Code: 137` 같은 형태로 보일 수 있음

**무엇을 먼저 볼까**
```bash
kubectl describe pod -n <ns> <pod> | egrep -n "OOMKilled|Exit Code|Reason"
kubectl top pod -n <ns> <pod> --containers
```

---

## 4) 프로브(헬스체크) 관련 상태/이벤트

### 🚦 Readiness probe failed
**의미**
- 컨테이너는 떠 있지만 **트래픽 받을 준비가 안 됨**  
- Service가 이 Pod로 라우팅하지 않을 수 있음(READY 0/1 등)

**대표 원인**
- 앱 초기화 미완료, 헬스체크 경로/포트 오류
- 의존 서비스(DB 등) 미기동

**무엇을 먼저 볼까**
```bash
kubectl describe pod -n <ns> <pod>   # Events에 HTTP code/메시지
kubectl logs -n <ns> <pod>
```

### 💀 Liveness probe failed
**의미**
- “살아있는지” 체크 실패 → kubelet이 컨테이너를 재시작  
- 반복되면 CrashLoopBackOff로 이어질 수 있음

**무엇을 먼저 볼까**
```bash
kubectl describe pod -n <ns> <pod>   # Events
kubectl logs -n <ns> <pod>
```

---

## 5) 생성/구성/마운트/네트워크 계열

### 🧩 ContainerCreating (오래 지속될 때 문제)
**의미**
- 컨테이너 생성 준비 중. 오래 멈추면 보통 **이미지/네트워크(CNI)/볼륨** 문제

**대표 원인**
- CNI(예: flannel) 문제로 Pod 네트워크 구성 실패
- 이미지 pull 지연
- 볼륨 마운트 실패/지연

**무엇을 먼저 볼까**
```bash
kubectl describe pod -n <ns> <pod>   # Events: FailedMount/CNI/pull 등
kubectl -n kube-system get pods -o wide
```

### 🧱 CreateContainerConfigError / RunContainerError
**의미**
- 컨테이너 실행 전 구성 단계에서 실패 (설정/참조 오류가 많음)

**대표 원인**
- 없는 ConfigMap/Secret 참조
- 잘못된 volumeMount/envFrom/command/args
- 보안컨텍스트/권한 문제

**무엇을 먼저 볼까**
```bash
kubectl describe pod -n <ns> <pod>   # Events가 핵심
```

### 📦 FailedMount (주로 Events 메시지로 표시)
**의미**
- 볼륨 마운트 실패(PVC/PV/CSI/NFS/권한/경로)

**무엇을 먼저 볼까**
```bash
kubectl describe pod -n <ns> <pod>   # Events
kubectl get pvc -n <ns>
kubectl describe pvc -n <ns> <pvc>
```

---

## 6) 종료/삭제 과정에서 걸리는 상태

### 🧹 Terminating (오래 지속될 때 문제)
**의미**
- Pod 삭제 중인데 마무리 단계가 끝나지 않음

**대표 원인**
- 노드 NotReady로 정리 작업 지연
- 볼륨 detach 실패
- finalizer로 인해 삭제가 막힘

**무엇을 먼저 볼까**
```bash
kubectl describe pod -n <ns> <pod>
kubectl get pod -n <ns> <pod> -o yaml | egrep -n "finalizers|deletionTimestamp"
```

---

## 7) “한 줄 요령”

- **Pending** → `describe`의 Events에서 “스케줄 불가/리소스/PVC”를 먼저 본다  
- **ImagePullBackOff** → “이미지 이름/인증/DNS/네트워크”를 본다  
- **CrashLoopBackOff** → `logs --previous` + `describe`의 Exit Code/Reason가 핵심  
- **OOMKilled** → 메모리 limit/사용량 확인(Exit Code 137 가능)  
- **probe 실패** → 경로/포트/초기화 타이밍/의존 서비스 점검

---
