# K3s ë…¸ë“œ(w3) NotReady + INTERNAL-IP ì˜¤ì¸(ì¤‘ë³µ/ì•„ì´ë´í‹°í‹° ê¼¬ì„) ì •ë¦¬

## 1) ê´€ì°°ëœ ì¦ìƒ

### (1) cp1ì—ì„œ ë³¸ ë…¸ë“œ ìƒíƒœ
- `cp1`ë§Œ **Ready**
- `w1 / w2 / w3`ëŠ” **NotReady**

```
ubuntu@cp1:~$ kubectl get nodes -o wide 
NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME 
cp1 Ready control-plane 4d4h v1.34.3+k3s1 192.168.56.10 <none> Ubuntu 22.04.5 LTS 5.15.0-164-generic containerd://2.1.5-k3s1 
w1 NotReady <none> 4d4h v1.34.3+k3s1 192.168.56.11 <none> Ubuntu 22.04.5 LTS 5.15.0-164-generic containerd://2.1.5-k3s1 
w2 NotReady <none> 4d4h v1.34.3+k3s1 192.168.56.12 <none> Ubuntu 22.04.5 LTS 5.15.0-164-generic containerd://2.1.5-k3s1 
w3 NotReady <none> 33m v1.34.3+k3s1 192.168.56.11 <none> Ubuntu 22.04.5 LTS 5.15.0-164-generic containerd://2.1.5-k3s1
```

- ìœ„ì—ì„œ w1 NotReady <none> 4d4h v1.34.3+k3s1 192.168.56.11 ... ê³¼ w3 NotReady <none> 33m v1.34.3+k3s1 192.168.56.11 ë™ì¼ 
- `kubectl get nodes -o wide`ì—ì„œ **w3ì˜ INTERNAL-IPê°€ `192.168.56.11`ë¡œ í‘œì‹œ**ë¨  
  â†’ ì´ ê°’ì€ `w1`ì˜ IPì™€ ë™ì¼í•˜ê²Œ ë³´ì„ (ì¶©ëŒ/ì˜¤ì¸ ê°€ëŠ¥)

### (2) w3ì—ì„œ ë³¸ ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ
- `ip -br a` ê²°ê³¼: `enp0s8`ê°€ **`192.168.56.13/24`ë¡œ ì •ìƒ**
- `/etc/netplan/*.yaml`ë„ `192.168.56.13/24`ë¡œ ì„¤ì •ë˜ì–´ ìˆìŒ

âœ… ê²°ë¡ ì ìœ¼ë¡œ, **w3 ìì²´ IPëŠ” ì •ìƒì¸ë° í´ëŸ¬ìŠ¤í„°ê°€ w3ë¥¼ `192.168.56.11`(w1)ë¡œ â€œì°©ê°â€**í•˜ëŠ” ìƒíƒœë¡œ ë³´ì„.

---

## 2) ê°€ì¥ ìœ ë ¥í•œ ì›ì¸(ê±°ì˜ í™•ì •)

### â€œë…¸ë“œ ì•„ì´ë´í‹°í‹°(ì‹ë³„ ì •ë³´) ë³µì œ/ì¬ì‚¬ìš©â€ ë˜ëŠ” â€œë…¸ë“œ ë“±ë¡ ì •ë³´ ê¼¬ì„â€
VMì„ í´ë¡ í–ˆê±°ë‚˜ ë„¤íŠ¸ì›Œí¬/ë””ìŠ¤í¬ë¥¼ ë³µì œí•œ í™˜ê²½ì—ì„œ ì•„ë˜ê°€ **w1ê³¼ ë™ì¼í•˜ê²Œ ë³µì œ**ë˜ë©´ ìì£¼ ë°œìƒí•©ë‹ˆë‹¤.

- `/etc/hostname` (hostname)
- `/etc/machine-id` (machine-id)
```
cd /etc
ls -al

-r--r--r--  1 root root      33 Jan  1 06:15 machine-id

ubuntu@cp1:/etc$ cat ./machine-id
912972408d93480fbc4263ea5c041eab
```

- k3s agentê°€ ì´ì „ ë…¸ë“œì˜ ì¸ì¦ì„œ/ìƒíƒœë¥¼ ë“¤ê³  ì¬ì¡°ì¸

ì´ ê²½ìš°, **ì„œë²„(cp1)ê°€ w3ë¥¼ ìƒˆ ë…¸ë“œë¡œ ì¸ì‹í•˜ì§€ ëª»í•˜ê³  ê¸°ì¡´ ë…¸ë“œ(w1)ì˜ ì •ì²´ì„±ì„ ë®ì–´ì“°ê±°ë‚˜ ê³µìœ **í•˜ê²Œ ë˜ì–´,
`kubectl get nodes`ì— **IPê°€ ì—‰ëš±í•˜ê²Œ í‘œì‹œ + NotReady**ê°€ ì§€ì†ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 3) ì›ì¸ í™•ì •ìš© ë¹ ë¥¸ ì²´í¬(10ì´ˆ)

w3ì—ì„œ ì•„ë˜ë¥¼ ì‹¤í–‰í•´ **w1ê³¼ ë™ì¼í•œì§€ ë¹„êµ**í•©ë‹ˆë‹¤.

```bash
hostname
cat /etc/hostname
cat /etc/machine-id
cat /var/lib/dbus/machine-id 2>/dev/null || true
```

- hostnameì´ `w1`ë¡œ ë‚˜ì˜¤ê±°ë‚˜
- machine-idê°€ w1ê³¼ ë™ì¼í•˜ë©´  
â†’ **100% ë³µì œ/ì•„ì´ë´í‹°í‹° ë¬¸ì œ**ì…ë‹ˆë‹¤.

---

## 4) í•´ê²°(ê°€ì¥ í™•ì‹¤): w3ë¥¼ â€œê¹¨ë—í•˜ê²Œ ì œê±° í›„ ì¬ì¡°ì¸(join)â€

> ëª©í‘œ: **w3ì˜ hostname + machine-id + k3s agent ìƒíƒœë¥¼ ëª¨ë‘ ìƒˆë¡œ** ë§Œë“¤ì–´  
> cp1ì´ w3ë¥¼ ì§„ì§œ â€œìƒˆ ë…¸ë“œâ€ë¡œ ì •ìƒ ë“±ë¡í•˜ê²Œ í•˜ê¸°

### Step A) cp1ì—ì„œ w3 ë…¸ë“œ ì‚­ì œ
```bash
kubectl delete node w3
```

> (ì„ íƒ) w3ê°€ ì‚­ì œê°€ ì•ˆ ë˜ê±°ë‚˜ ë…¸ë“œ ë ˆì½”ë“œê°€ ê¼¬ì˜€ìœ¼ë©´, ìƒí™©ì— ë”°ë¼ w1ë„ ì •ë¦¬ ëŒ€ìƒì´ ë  ìˆ˜ ìˆìŒ.

---

### Step B) w3ì—ì„œ k3s-agent ì™„ì „ ì œê±°/ì´ˆê¸°í™”
```bash
sudo /usr/local/bin/k3s-agent-uninstall.sh
sudo rm -rf /etc/rancher /var/lib/rancher
```

---

### Step C) w3 hostnameì„ ìœ ë‹ˆí¬í•˜ê²Œ ì„¤ì •
```bash
sudo hostnamectl set-hostname w3
```

---

### Step D) machine-id ì¬ìƒì„±(í´ë¡  VMì—ì„œ í•µì‹¬)
```bash
sudo rm -f /etc/machine-id /var/lib/dbus/machine-id
sudo systemd-machine-id-setup
sudo reboot
```

---

### Step E) ì¬ë¶€íŒ… í›„ w3 ì¬ì¡°ì¸(join)

#### 1) cp1ì—ì„œ í† í° í™•ì¸
```bash
sudo cat /var/lib/rancher/k3s/server/node-token
```

#### 2) w3ì—ì„œ agent ì„¤ì¹˜/ì‹¤í–‰
(ì„œë²„ URLì€ cp1: `192.168.56.10:6443` ê¸°ì¤€)

```bash
curl -sfL https://get.k3s.io |   K3S_URL=https://192.168.56.10:6443   K3S_TOKEN='<ìœ„ í† í°>'   sh -

sudo systemctl enable --now k3s-agent
```

---

## 5) ì •ìƒ ë³µêµ¬ í™•ì¸

cp1ì—ì„œ:

```bash
kubectl get nodes -o wide
```

ì •ìƒ ê¸°ì¤€:
- `w3`ê°€ **Ready**
- `w3`ì˜ INTERNAL-IPê°€ **`192.168.56.13`ìœ¼ë¡œ ì •í™•íˆ í‘œì‹œ**

---

## 6) ì¶”ê°€ ì ê²€(ë…¸ë“œ NotReady / Pod Pending ì›ì¸ í™•ì¸)

### (1) ì›Œì»¤ ë…¸ë“œì—ì„œ agent ìƒíƒœ/ë¡œê·¸ í™•ì¸
ê° ì›Œì»¤(w1/w2/w3)ì—ì„œ:

```bash
sudo systemctl status k3s-agent
sudo journalctl -u k3s-agent -n 200 --no-pager
```

### (2) Podê°€ Pending/ìŠ¤ì¼€ì¤„ ì‹¤íŒ¨ í™•ì¸
cp1ì—ì„œ:

```bash
kubectl get pods -A -o wide | egrep "Pending|Terminating|CrashLoop|demo-hpa|kube-system" -n
kubectl -n demo-hpa get events --sort-by=.lastTimestamp | tail -n 50
```

---

## 7) í•µì‹¬ ìš”ì•½(í•œ ì¤„ ê²°ë¡ )

w3ì˜ ë„¤íŠ¸ì›Œí¬/IP ìì²´ ë¬¸ì œë¼ê¸°ë³´ë‹¤,  
**í´ëŸ¬ìŠ¤í„°ê°€ w3ë¥¼ w1ë¡œ ì˜¤ì¸í•˜ëŠ” â€œë…¸ë“œ ì•„ì´ë´í‹°í‹°( hostname/machine-id/k3s ìƒíƒœ ) ê¼¬ì„â€**ì´ í•µì‹¬ì´ë©°,  
**w3ë¥¼ ì™„ì „ ì´ˆê¸°í™” â†’ hostname/machine-id ì¬ìƒì„± â†’ k3s-agent ì¬ì¡°ì¸**ì´ ê°€ì¥ í™•ì‹¤í•œ í•´ê²°ì±…ì…ë‹ˆë‹¤.



---
---

# docker run vs kubectl: ë™ì‘ ë°©ì‹ê³¼ Kubernetes API ëª©ë¡ í™•ì¸ ë°©ë²• ì •ë¦¬

> ì´ ë¬¸ì„œëŠ” ë‹¤ìŒì„ ì •ë¦¬í•©ë‹ˆë‹¤.

- **docker run**ì€ ì™œ â€œë¡œì»¬ì—ì„œ ì¦‰ì‹œ ì‹¤í–‰â€ì¸ì§€  
- **kubectl**ì€ ì™œ â€œí´ëŸ¬ìŠ¤í„° API(Server)ì— ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­â€í•˜ëŠ” ê²ƒì¸ì§€  
- kubectl ì‹¤í–‰ ì‹œ **Kubernetes API Serverê°€ ì œê³µí•˜ëŠ” API(ë¦¬ì†ŒìŠ¤/ì—”ë“œí¬ì¸íŠ¸/ìŠ¤í‚¤ë§ˆ)** ë¥¼ **ëª©ë¡ìœ¼ë¡œ í™•ì¸í•˜ëŠ” ë°©ë²•**

---

## 1) docker runì€ â€œë¡œì»¬ ì—”ì§„â€ì— ì§ì ‘ ëª…ë ¹

### ëª…ë ¹ì„ ë°›ëŠ” ëŒ€ìƒ
- ë‚´ PC/ì„œë²„ì˜ **Docker Engine(dockerd)**

### docker runì´ í•˜ëŠ” ì¼(ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ìˆ˜í–‰)
- ì´ë¯¸ì§€ pull(í•„ìš” ì‹œ)  
- ì»¨í…Œì´ë„ˆ ìƒì„±  
- ì»¨í…Œì´ë„ˆ ì‹¤í–‰  
- ë¡œì»¬ í”„ë¡œì„¸ìŠ¤/ë„¤ì„ìŠ¤í˜ì´ìŠ¤/ë„¤íŠ¸ì›Œí¬ ë“±ì„ Dockerê°€ ì§ì ‘ ê´€ë¦¬

âœ… ê²°ë¡ : **docker runì€ â€œë‚´ ë¨¸ì‹ ì—ì„œ ë°”ë¡œ ì‹¤í–‰â€** ì…ë‹ˆë‹¤.

---

## 2) kubectlì€ â€œí´ëŸ¬ìŠ¤í„° APIâ€ì— ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸

# kubectlì´ ëª…ë ¹ì„ ë³´ë‚´ëŠ” ëŒ€ìƒ
- **Kubernetes API Server**

### kubectl run/create/applyê°€ í•˜ëŠ” ì¼(ë³¸ì§ˆ)
- â€œPod/Deployment ê°™ì€ Kubernetes ë¦¬ì†ŒìŠ¤(ì„ ì–¸)ë¥¼ ë§Œë“¤ì–´ì¤˜â€ ë¼ëŠ” **API ìš”ì²­**

### ê·¸ ë‹¤ìŒ ì‹¤ì œ ì‹¤í–‰ íë¦„(í´ëŸ¬ìŠ¤í„° ë‚´ë¶€)
1. (API Server) ìš”ì²­ì„ ë°›ì•„ ë¦¬ì†ŒìŠ¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ì €ì¥/ê´€ë¦¬  
2. (ì»¨íŠ¸ë¡¤ëŸ¬) ì›í•˜ëŠ” ìƒíƒœë¥¼ ë§ì¶”ê¸° ìœ„í•´ ReplicaSet/Pod ë“±ì„ ìƒì„±/ì¡°ì •  
3. (ìŠ¤ì¼€ì¤„ëŸ¬) Podë¥¼ ì‹¤í–‰í•  Nodeë¥¼ ì„ íƒ  
4. (kubelet) í•´ë‹¹ Nodeì—ì„œ Pod ì‹¤í–‰ ì§€ì‹œë¥¼ ë°›ê³  ì²˜ë¦¬  
5. (ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„: containerd/CRI-O ë“±) ì‹¤ì œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰

### kubelet -> Readme.md íŒŒì¼ì—ì„œ ë‹¤ì‹œ í™•ì¸

âœ… ê²°ë¡ : **kubectlì€ ì»¨í…Œì´ë„ˆë¥¼ ì§ì ‘ ì‹¤í–‰í•˜ëŠ” ë„êµ¬ê°€ ì•„ë‹ˆë¼**  
í´ëŸ¬ìŠ¤í„°ì— **â€œì´ëŸ° ìƒíƒœë¡œ ìš´ì˜í•´â€** ë¼ê³  ìš”ì²­í•˜ëŠ” **í´ë¼ì´ì–¸íŠ¸**ì…ë‹ˆë‹¤.

---

## 3) ì™œ kubectl runì´ docker runì²˜ëŸ¼ ë³´ì´ë‚˜?

- ì´ˆê¸° í•™ìŠµ/í…ŒìŠ¤íŠ¸ í¸ì˜ë¡œ `kubectl run nginx --image=nginx` ê°™ì€ UXë¥¼ ì œê³µ
- í•˜ì§€ë§Œ ì´ëŠ” â€œì»¨í…Œì´ë„ˆë¥¼ ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ì‹¤í–‰â€ì´ ì•„ë‹ˆë¼  
  **Pod/Deployment ìƒì„± ìš”ì²­(ì„ ì–¸)** ì…ë‹ˆë‹¤.

---

## 4) êµ¬í˜„ ì–¸ì–´(ì˜¤í•´ ì •ë¦¬)

- **kubectl**: Kubernetes ê³µì‹ CLI, **Go ì–¸ì–´** ê¸°ë°˜
- Docker CLI/ìƒíƒœê³„ë„ Go ì¤‘ì‹¬ ì»´í¬ë„ŒíŠ¸ê°€ ë§ìŒ
- ì¦‰, â€œkubectlì´ íŒŒì´ì¬ìœ¼ë¡œ docker runì„ ê°œì¡°í•œ ê²ƒâ€ì´ ì•„ë‹™ë‹ˆë‹¤.

---

## 5) í•œ ì¤„ ë¹„êµ

- **docker run** = ë¡œì»¬ ëŸ°íƒ€ì„ì— ì¦‰ì‹œ ì‹¤í–‰  
- **kubectl run/apply** = API Serverì— ë¦¬ì†ŒìŠ¤ ìƒì„± ìš”ì²­ â†’ ì»¨íŠ¸ë¡¤ëŸ¬/ìŠ¤ì¼€ì¤„ëŸ¬/kubeletì´ ì‹¤í–‰

---

# Kubernetes API Serverì˜ API â€œëª©ë¡â€ ë³´ëŠ” ë°©ë²•

â€œëª©ë¡â€ì€ í¬ê²Œ ë‘ ì¢…ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤.

1) **ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ì œê³µí•˜ëŠ” ë¦¬ì†ŒìŠ¤(API ì˜¤ë¸Œì íŠ¸) ëª©ë¡**  
2) **API Serverê°€ ì‹¤ì œë¡œ ë…¸ì¶œí•˜ëŠ” HTTP ì—”ë“œí¬ì¸íŠ¸ ê²½ë¡œ(/api, /apis â€¦) ëª©ë¡**

---

## A. ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤(API ì˜¤ë¸Œì íŠ¸) ëª©ë¡ ë³´ê¸°

### 1) ì „ì²´ ë¦¬ì†ŒìŠ¤ ëª©ë¡
```sh
kubectl api-resources
```
- `pods`, `services`, `deployments` ê°™ì€ ë¦¬ì†ŒìŠ¤ ì´ë¦„
- `GROUP`(ì˜ˆ: apps), `VERSION`(ì˜ˆ: v1), `KIND`(ì˜ˆ: Deployment)
- Namespaced ì—¬ë¶€ë„ í•¨ê»˜ í‘œì‹œ

### 2) íŠ¹ì • API ê·¸ë£¹ë§Œ ë³´ê¸° (ì˜ˆ: apps)
```sh
kubectl api-resources --api-group=apps
```
```
ubuntu@cp1:/etc$ kubectl api-resources --api-group=apps
NAME                  SHORTNAMES   APIVERSION   NAMESPACED   KIND
controllerrevisions                apps/v1      true         ControllerRevision
daemonsets            ds           apps/v1      true         DaemonSet
deployments           deploy       apps/v1      true         Deployment
replicasets           rs           apps/v1      true         ReplicaSet
statefulsets          sts          apps/v1      true         StatefulSet
```

### 3) ì§€ì›í•˜ëŠ” API ë²„ì „ ëª©ë¡
```sh
kubectl api-versions
```
```
ubuntu@cp1:/etc$ kubectl api-versions
admissionregistration.k8s.io/v1
apiextensions.k8s.io/v1
apiregistration.k8s.io/v1
apps/v1
authentication.k8s.io/v1
authorization.k8s.io/v1
autoscaling/v1
autoscaling/v2
batch/v1
certificates.k8s.io/v1
configuration.konghq.com/v1
configuration.konghq.com/v1alpha1
configuration.konghq.com/v1beta1
coordination.k8s.io/v1
discovery.k8s.io/v1
events.k8s.io/v1
flowcontrol.apiserver.k8s.io/v1
gateway.networking.k8s.io/v1
gateway.networking.k8s.io/v1beta1
helm.cattle.io/v1
hub.traefik.io/v1alpha1
k3s.cattle.io/v1
metrics.k8s.io/v1beta1
networking.k8s.io/v1
node.k8s.io/v1
policy/v1
rbac.authorization.k8s.io/v1
resource.k8s.io/v1
scheduling.k8s.io/v1
storage.k8s.io/v1
traefik.io/v1alpha1
v1
```

---

## B. API Serverì˜ â€œì‹¤ì œ HTTP API ê²½ë¡œâ€ ëª©ë¡ ë³´ê¸°

> `kubectl get --raw`ëŠ” API Serverì— raw ìš”ì²­ì„ ë³´ë‚´ê³  JSONì„ ê·¸ëŒ€ë¡œ ë°›ìŠµë‹ˆë‹¤.

### 1) ì½”ì–´ API ë£¨íŠ¸ (legacy core)
```sh
kubectl get --raw /api
```
```
ubuntu@cp1:/etc$ kubectl get --raw /api
{"kind":"APIVersions","versions":["v1"],"serverAddressByClientCIDRs":[{"clientCIDR":"0.0.0.0/0","serverAddress":"192.168.56.10:6443"}]}
```

### CP ì—ì„œ API ì„œë²„ë¡œì„œ Swagger ë¡œ ë³´ê¸°
```sh
kubectl proxy --address='0.0.0.0' --port=8001 --accept-hosts='^.*$'
```
```
ubuntu@cp1:/etc$ kubectl proxy --address='0.0.0.0' --port=8001 --accept-hosts='^.*$'
Starting to serve on [::]:8001
```
### ìœ„ì™€ ê°™ì´ ì›¹ ë°ëª¬ ì‹¤í–‰ ì¤‘ì´ê³ , ì›¹ ë¸Œë¼ìš°ì €ë¡œ ì ‘ì†
![alt text](image-26.png)

---
---
## ë‚˜ì˜ PC í˜¸ìŠ¤íŠ¸ì—ì„œ í•´ë‹¹ json ë‹¤ìš´ë¡œë“œ
![alt text](image-19.png)
---

```sh
c:\temp ë“±ì˜ ê°„ë‹¨íˆ ë””ë ‰í† ë¦¬ ìƒì„± í›„
curl.exe -s http://192.168.56.10:8001/openapi/v2 -o openapi.json
```
---

```sh
PS C:\temp> ls
    ë””ë ‰í„°ë¦¬: C:\temp
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----      2026-01-23   ì˜¤í›„ 3:31        3543638 openapi.json
```
---
### Docker ë¡œ ì˜¬ë ¤ ë³´ê¸° - íŒŒì›Œì…¸ì—ì„œ ì‹¤í–‰
```sh
docker run --rm -p 8088:8080 `
  -e SWAGGER_JSON=/spec/openapi.json `
  -v "${PWD}\openapi.json:/spec/openapi.json:ro" `
  swaggerapi/swagger-ui
```
---
### ë‚´ PC ì—ì„œ ë„ìš´ ì»¨í…Œì´ë„ˆ ì´ë¯€ë¡œ ë¸Œë¼ìš°ì €ì—ì„œ http://127.0.0.1:8088/ ìœ¼ë¡œ ë³¼ê²ƒ. ë‹¨, ì‹¤ì‹œê°„ ë°ì´íƒ€ê°€ ì•„ë‹Œ json ì˜ íŒŒì‹± í˜•íƒœì„
![alt text](image-17.png)


### 2) API ê·¸ë£¹ ëª©ë¡
```sh
kubectl get --raw /apis
```

### 3) íŠ¹ì • ê·¸ë£¹ì˜ ë²„ì „ ë³´ê¸° (ì˜ˆ: apps)
```sh
kubectl get --raw /apis/apps
```

### 4) íŠ¹ì • ê·¸ë£¹/ë²„ì „ì˜ ë¦¬ì†ŒìŠ¤ ë³´ê¸° (ì˜ˆ: apps/v1)
```sh
kubectl get --raw /apis/apps/v1
```

ğŸ“Œ `/apis/apps/v1` ì¶œë ¥ JSONì—ëŠ” `resources` ë°°ì—´ì´ ìˆê³   
ê·¸ ì•ˆì— `deployments`, `replicasets` ë“± ë¦¬ì†ŒìŠ¤ ê²½ë¡œê°€ ë‚˜ì˜µë‹ˆë‹¤.

---
---


## C. OpenAPI ìŠ¤í™ìœ¼ë¡œ â€œì „ì²´ API ìŠ¤í‚¤ë§ˆâ€ ë°›ê¸°

### OpenAPI v2 ìŠ¤í‚¤ë§ˆ ì €ì¥
```sh
kubectl get --raw /openapi/v2 > openapi.json
ls -al openapi.json
```
---
```sh
ubuntu@w2:~$ kubectl get --raw /openapi/v2 > openapi.json
ubuntu@w2:~$ ls -al
total 3492
drwxr-x--- 5 ubuntu ubuntu    4096 Jan 24 06:09 .
drwxr-xr-x 3 root   root      4096 Jan  1 06:28 ..
-rw------- 1 ubuntu ubuntu     335 Jan 24 02:07 .bash_history
-rw-r--r-- 1 ubuntu ubuntu       0 Jan  6  2022 .bash_logout
-rw-r--r-- 1 ubuntu ubuntu       0 Jan  6  2022 .bashrc
drwx------ 2 ubuntu ubuntu    4096 Jan  1 06:31 .cache
drwxrwxr-x 3 ubuntu ubuntu    4096 Jan 24 05:58 .kube
-rw-r--r-- 1 ubuntu ubuntu       0 Jan  6  2022 .profile
drwx------ 2 ubuntu ubuntu    4096 Jan 24 02:42 .ssh
-rw-r--r-- 1 ubuntu ubuntu       0 Jan  3 01:44 .sudo_as_admin_successful
-rw------- 1 ubuntu ubuntu     725 Jan 24 05:54 .viminfo
-rw-rw-r-- 1 ubuntu ubuntu 3543638 Jan 24 06:09 openapi.json
```

### (ê°€ëŠ¥í•˜ë©´) OpenAPI v3 í™•ì¸
```sh
kubectl get --raw /openapi/v3 | head
```
â€» í´ëŸ¬ìŠ¤í„°/ê¶Œí•œ/ë²„ì „ì— ë”°ë¼ v3 ì œê³µ ì—¬ë¶€ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## D. kubectlì´ â€œì‹¤ì œë¡œ ì–´ë–¤ URLì„ í˜¸ì¶œí–ˆëŠ”ì§€â€ ë¡œê·¸ë¡œ ë³´ê¸°

```sh
kubectl -v=8 get pods -A
kubectl -v=8 get deploy -A
```
![alt text](image-20.png)

- ì¶œë ¥ì— `GET https://.../api/v1/...` ë˜ëŠ” `.../apis/apps/v1/...` í˜•íƒœë¡œ  
  ì‹¤ì œ í˜¸ì¶œ URL/íë¦„ì´ ë³´ì…ë‹ˆë‹¤.
- ë” ìì„¸íˆ: `-v=9`


---

### k3s í¬í•¨ â€œë‚´ í´ëŸ¬ìŠ¤í„°ì—ì„œ API ëª©ë¡ í™•ì¸â€ ì¶”ì²œ ì»¤ë§¨ë“œ ì„¸íŠ¸

### ì—°ê²° í™•ì¸
```sh
kubectl cluster-info
kubectl config view --minify
```

### ë¦¬ì†ŒìŠ¤/ë²„ì „ ëª©ë¡
```sh
kubectl api-resources
kubectl api-resources --namespaced=true
kubectl api-resources --namespaced=false
kubectl api-resources --api-group=apps
kubectl api-versions
```

### ì—”ë“œí¬ì¸íŠ¸ íŠ¸ë¦¬ í™•ì¸
```sh
kubectl get --raw /api | head
kubectl get --raw /apis | head
kubectl get --raw /apis/apps | head
kubectl get --raw /apis/apps/v1 | head
```

### ìŠ¤í‚¤ë§ˆ ì €ì¥
```sh
kubectl get --raw /openapi/v2 > openapi.json
ls -al openapi.json
```

### ì‹¤ì œ í˜¸ì¶œ URL ë³´ê¸°
```sh
kubectl -v=8 get pods -A
kubectl -v=8 get deploy -A
```

### ë¦¬ì†ŒìŠ¤ ìŠ¤í™ í•„ë“œ êµ¬ì¡° í™•ì¸
```sh
kubectl explain deployment
kubectl explain deployment.spec
kubectl explain deployment.spec.template.spec.containers
```

---

## ì°¸ê³ : â€œëª©ë¡â€ì„ ë³´ëŠ” ëª©ì ì— ë”°ë¥¸ ë¹ ë¥¸ ì„ íƒ

- **ë¦¬ì†ŒìŠ¤ íƒ€ì…(Kind) ë­ ìˆë‚˜?** â†’ `kubectl api-resources`
- **API ê·¸ë£¹/ë²„ì „ ë­ ì§€ì›í•˜ë‚˜?** â†’ `kubectl api-versions`
- **API Serverì˜ ì‹¤ì œ REST ê²½ë¡œ íŠ¸ë¦¬?** â†’ `kubectl get --raw /api`, `/apis`
- **ì „ì²´ API ìŠ¤í‚¤ë§ˆ(í•„ë“œê¹Œì§€) ë°›ê³  ì‹¶ë‹¤** â†’ `/openapi/v2`

- **kubectlì´ ì‹¤ì œë¡œ ë•Œë¦° URL ë³´ê³  ì‹¶ë‹¤** â†’ `kubectl -v=8 ...`
### ìœ„ì˜ ë‚´ìš© ì˜ˆì‹œ
```
ubuntu@cp1:/etc$ kubectl -v=8 get nodes -o wide
I0126 07:15:48.185193   48885 loader.go:402] Config loaded from file:  /etc/rancher/k3s/k3s.yaml
I0126 07:15:48.210139   48885 helper.go:113] "Request Body" body=""
I0126 07:15:48.213159   48885 round_trippers.go:527] "Request" verb="GET" url="https://127.0.0.1:6443/api/v1/nodes?limit=500" headers=<
        Accept: application/json;as=Table;v=v1;g=meta.k8s.io,application/json;as=Table;v=v1beta1;g=meta.k8s.io,application/json
        User-Agent: kubectl/v1.34.3+k3s1 (linux/amd64) kubernetes/48ffa7b
 >
I0126 07:15:48.228665   48885 round_trippers.go:632] "Response" status="200 OK" headers=<
        Audit-Id: 70e26430-ff1d-4f79-813c-75cc16ebac95
        Cache-Control: no-cache, private
        Content-Type: application/json
        Date: Mon, 26 Jan 2026 07:15:48 GMT
        X-Kubernetes-Pf-Flowschema-Uid: fd2e584d-90ae-47c5-9d69-68fb3dd04504
        X-Kubernetes-Pf-Prioritylevel-Uid: 14292c52-4849-40da-a9b7-aaf6acae16c1
 > milliseconds=10
I0126 07:15:48.235903   48885 helper.go:113] "Response Body" body="{\"kind\":\"Table\",\"apiVersion\":\"meta.k8s.io/v1\",\"metadata\":{\"resourceVersion\":\"21764\"},\"columnDefinitions\":[{\"name\":\"Name\",\"type\":\"string\",\"format\":\"name\",\"description\":\"Name must be unique within a namespace. Is required when creating resources, although some resources may allow a client to request the generation of an appropriate name automatically. Name is primarily intended for creation idempotence and configuration definition. Cannot be updated. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names#names\",\"priority\":0},{\"name\":\"Status\",\"type\":\"string\",\"format\":\"\",\"description\":\"The status of the node\",\"priority\":0},{\"name\":\"Roles\",\"type\":\"string\",\"format\":\"\",\"description\":\"The roles of the node\",\"priority\":0},{\"name\":\"Age\",\"type\":\"string\",\"format\":\"\",\"description\":\"CreationTimestamp is a timestamp representing the server time when this object was created. It is not guaranteed to be set in happens-before order across separate operations. Clients may not set this value. It is rep [truncated 12279 chars]"
NAME   STATUS                     ROLES           AGE   VERSION        INTERNAL-IP     EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION       CONTAINER-RUNTIME
cp1    Ready                      control-plane   23d   v1.34.3+k3s1   192.168.56.10   <none>        Ubuntu 22.04.5 LTS   5.15.0-164-generic   containerd://2.1.5-k3s1
w1     Ready,SchedulingDisabled   <none>          23d   v1.34.3+k3s1   192.168.56.11   <none>        Ubuntu 22.04.5 LTS   5.15.0-164-generic   containerd://2.1.5-k3s1
w2     Ready                      <none>          23d   v1.34.3+k3s1   192.168.56.12   <none>        Ubuntu 22.04.5 LTS   5.15.0-164-generic   containerd://2.1.5-k3s1
```
---
```
ubuntu@cp1:/etc$ kubectl -v=8 -n kube-system get pods \
  --field-selector=status.phase!=Running \
  -o wide
I0126 07:16:57.153803   48921 loader.go:402] Config loaded from file:  /etc/rancher/k3s/k3s.yaml
I0126 07:16:57.170226   48921 helper.go:113] "Request Body" body=""
I0126 07:16:57.174057   48921 round_trippers.go:527] "Request" verb="GET" url="https://127.0.0.1:6443/api/v1/namespaces/kube-system/pods?fieldSelector=status.phase%21%3DRunning&limit=500" headers=<
        Accept: application/json;as=Table;v=v1;g=meta.k8s.io,application/json;as=Table;v=v1beta1;g=meta.k8s.io,application/json
        User-Agent: kubectl/v1.34.3+k3s1 (linux/amd64) kubernetes/48ffa7b
 >
I0126 07:16:57.183078   48921 round_trippers.go:632] "Response" status="200 OK" headers=<
        Audit-Id: ad97ff41-b1be-42b0-b9b1-1695f4edc45c
        Cache-Control: no-cache, private
        Content-Type: application/json
        Date: Mon, 26 Jan 2026 07:16:57 GMT
        X-Kubernetes-Pf-Flowschema-Uid: fd2e584d-90ae-47c5-9d69-68fb3dd04504
        X-Kubernetes-Pf-Prioritylevel-Uid: 14292c52-4849-40da-a9b7-aaf6acae16c1
 > milliseconds=6
I0126 07:16:57.187844   48921 helper.go:113] "Response Body" body="{\"kind\":\"Table\",\"apiVersion\":\"meta.k8s.io/v1\",\"metadata\":{\"resourceVersion\":\"21798\"},\"columnDefinitions\":[{\"name\":\"Name\",\"type\":\"string\",\"format\":\"name\",\"description\":\"Name must be unique within a namespace. Is required when creating resources, although some resources may allow a client to request the generation of an appropriate name automatically. Name is primarily intended for creation idempotence and configuration definition. Cannot be updated. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names#names\",\"priority\":0},{\"name\":\"Ready\",\"type\":\"string\",\"format\":\"\",\"description\":\"The aggregate readiness state of this pod for accepting traffic.\",\"priority\":0},{\"name\":\"Status\",\"type\":\"string\",\"format\":\"\",\"description\":\"The aggregate status of the containers in this pod.\",\"priority\":0},{\"name\":\"Restarts\",\"type\":\"string\",\"format\":\"\",\"description\":\"The number of times the containers in this pod have been restarted and when the last container in this pod has restarted.\",\"priority\":0},{\" [truncated 12600 chars]"
NAME                             READY   STATUS      RESTARTS   AGE   IP          NODE   NOMINATED NODE   READINESS GATES
helm-install-traefik-crd-rjtd8   0/1     Completed   0          23d   10.42.0.2   cp1    <none>           <none>
helm-install-traefik-zxz5t       0/1     Completed   1          23d   10.42.0.6   cp1    <none>           <none>
```
### kubectl describe / kubectl logs / kubectl execë„ URL í™•ì¸ ê°€ëŠ¥
```
kubectl -v=8 describe node w3
```
```
kubectl get pods -o wide
kubectl -v=8 exec -it pod/nginx-66686b6766-frj65 -- sh
```
## ì£¼ì˜ì‚¬í•­ exec -it ìœ¼ë¡œ ì»¨í…Œì´ë„ˆì˜ ë¦¬ëˆ…ìŠ¤ì— ì ‘ì†í•œ ìƒíƒœ ì´ë¯€ë¡œ, exit ë¡œ ë¹ ì ¸ ë‚˜ì˜¤ê±°ë‚˜, ê³„ì† ë‚¨ì•„ í—›ëŒë©´, ssh ì ‘ì† ì¢…ë£Œ í•„ìš”