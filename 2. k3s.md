# K3s 멀티노드 빠른 요약 (VirtualBox Host-Only 192.168.56.x)

> 목표: VM 3대(cp1/w1/w2)를 Host-Only 네트워크로 묶고
> K3s 멀티노드 클러스터를 설치합니다.

---

## 1) VM 네트워크 설정 (3대 모두)

VirtualBox → VM 설정 → Network

- **Adapter 1**: NAT
- **Adapter 2**: Host-only Adapter
  - Name: VirtualBox Host-Only Ethernet Adapter
  - ✅ Cable connected

---

## 2) Ubuntu Host-Only 고정 IP 설정 (netplan)

인터페이스 확인:

```bash
ip -br a
```

보통:
- NAT: `enp0s3`
- Host-Only: `enp0s8`

### cp1 (192.168.56.10)

```bash
sudo tee /etc/netplan/00-installer-config.yaml >/dev/null <<'NETPLAN'
network:
  version: 2
  ethernets:
    enp0s3:
      dhcp4: true
    enp0s8:
      dhcp4: no
      addresses: [192.168.56.10/24]
NETPLAN

sudo netplan apply
ip -br a
```

### w1 / w2

`192.168.56.11`, `192.168.56.12`로 IP만 변경해 동일하게 적용합니다.

---

## 3) 통신 테스트

Windows → cp1:

```powershell
ping 192.168.56.10
```

cp1 → Windows Host-Only:

```bash
ping -c 1 192.168.56.1
```

---

## 4) K3s 설치

### 4-1) 호스트명 설정 (각 VM에서 1회)

```bash
sudo hostnamectl set-hostname cp1   # cp1
sudo hostnamectl set-hostname w1    # w1
sudo hostnamectl set-hostname w2    # w2
```

### 4-2) cp1: 서버 설치

```bash
sudo apt update && sudo apt install -y curl

curl -sfL https://get.k3s.io | \
  K3S_KUBECONFIG_MODE="644" sh -s - \
  --node-ip 192.168.56.10 \
  --flannel-iface enp0s8
```

토큰 확인:

```bash
sudo cat /var/lib/rancher/k3s/server/node-token
```

### 4-3) w1/w2: 워커 조인

```bash
sudo apt update && sudo apt install -y curl

curl -sfL https://get.k3s.io | \
  K3S_URL="https://192.168.56.10:6443" \
  K3S_TOKEN="(cp1에서 복사한 토큰)" sh -s - \
  --node-ip 192.168.56.11 \
  --flannel-iface enp0s8
```

w2는 `--node-ip 192.168.56.12`로 변경합니다.

---

## 5) 최종 확인 (cp1)

```bash
kubectl get nodes -o wide
kubectl get pods -A
```

---

## 참고

- WSL은 워커 조인 대신 `kubectl` 관리용으로만 사용하는 것을 권장합니다.
