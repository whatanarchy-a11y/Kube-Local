# docker run vs kubectl: ë™ì‘ ë°©ì‹ê³¼ Kubernetes API ëª©ë¡ í™•ì¸ ë°©ë²• ì •ë¦¬

> ì´ ë¬¸ì„œëŠ” ë‹¤ìŒì„ ì •ë¦¬í•©ë‹ˆë‹¤.

- **docker run**ì€ ì™œ â€œë¡œì»¬ì—ì„œ ì¦‰ì‹œ ì‹¤í–‰â€ì¸ì§€  
- **kubectl**ì€ ì™œ â€œí´ëŸ¬ìŠ¤í„° API(Server)ì— ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­â€í•˜ëŠ” ê²ƒì¸ì§€  
- kubectl ì‹¤í–‰ ì‹œ **Kubernetes API Serverê°€ ì œê³µí•˜ëŠ” API(ë¦¬ì†ŒìŠ¤/ì—”ë“œí¬ì¸íŠ¸/ìŠ¤í‚¤ë§ˆ)** ë¥¼ **ëª©ë¡ìœ¼ë¡œ í™•ì¸í•˜ëŠ” ë°©ë²•**

---

## 1) docker runì€ â€œë¡œì»¬ ì—”ì§„â€ì— ì§ì ‘ ëª…ë ¹

### ëª…ë ¹ì„ ë°›ëŠ” ëŒ€ìƒ
- ë‚´ PC/ì„œë²„ì˜ **Docker Engine(dockerd)**

### docker runì´ í•˜ëŠ” ì¼(ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ìˆ˜í–‰)
- ì´ë¯¸ì§€ pull(í•„ìš” ì‹œ)  
- ì»¨í…Œì´ë„ˆ ìƒì„±  
- ì»¨í…Œì´ë„ˆ ì‹¤í–‰  
- ë¡œì»¬ í”„ë¡œì„¸ìŠ¤/ë„¤ì„ìŠ¤í˜ì´ìŠ¤/ë„¤íŠ¸ì›Œí¬ ë“±ì„ Dockerê°€ ì§ì ‘ ê´€ë¦¬

âœ… ê²°ë¡ : **docker runì€ â€œë‚´ ë¨¸ì‹ ì—ì„œ ë°”ë¡œ ì‹¤í–‰â€** ì…ë‹ˆë‹¤.

---

## 2) kubectlì€ â€œí´ëŸ¬ìŠ¤í„° APIâ€ì— ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸

### kubectlì´ ëª…ë ¹ì„ ë³´ë‚´ëŠ” ëŒ€ìƒ
- **Kubernetes API Server**

### kubectl run/create/applyê°€ í•˜ëŠ” ì¼(ë³¸ì§ˆ)
- â€œPod/Deployment ê°™ì€ Kubernetes ë¦¬ì†ŒìŠ¤(ì„ ì–¸)ë¥¼ ë§Œë“¤ì–´ì¤˜â€ ë¼ëŠ” **API ìš”ì²­**

### ê·¸ ë‹¤ìŒ ì‹¤ì œ ì‹¤í–‰ íë¦„(í´ëŸ¬ìŠ¤í„° ë‚´ë¶€)
1. (API Server) ìš”ì²­ì„ ë°›ì•„ ë¦¬ì†ŒìŠ¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ì €ì¥/ê´€ë¦¬  
2. (ì»¨íŠ¸ë¡¤ëŸ¬) ì›í•˜ëŠ” ìƒíƒœë¥¼ ë§ì¶”ê¸° ìœ„í•´ ReplicaSet/Pod ë“±ì„ ìƒì„±/ì¡°ì •  
3. (ìŠ¤ì¼€ì¤„ëŸ¬) Podë¥¼ ì‹¤í–‰í•  Nodeë¥¼ ì„ íƒ  
4. (kubelet) í•´ë‹¹ Nodeì—ì„œ Pod ì‹¤í–‰ ì§€ì‹œë¥¼ ë°›ê³  ì²˜ë¦¬  
5. (ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„: containerd/CRI-O ë“±) ì‹¤ì œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰

âœ… ê²°ë¡ : **kubectlì€ ì»¨í…Œì´ë„ˆë¥¼ ì§ì ‘ ì‹¤í–‰í•˜ëŠ” ë„êµ¬ê°€ ì•„ë‹ˆë¼**  
í´ëŸ¬ìŠ¤í„°ì— **â€œì´ëŸ° ìƒíƒœë¡œ ìš´ì˜í•´â€** ë¼ê³  ìš”ì²­í•˜ëŠ” **í´ë¼ì´ì–¸íŠ¸**ì…ë‹ˆë‹¤.

---

## 3) ì™œ kubectl runì´ docker runì²˜ëŸ¼ ë³´ì´ë‚˜?

- ì´ˆê¸° í•™ìŠµ/í…ŒìŠ¤íŠ¸ í¸ì˜ë¡œ `kubectl run nginx --image=nginx` ê°™ì€ UXë¥¼ ì œê³µ
- í•˜ì§€ë§Œ ì´ëŠ” â€œì»¨í…Œì´ë„ˆë¥¼ ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ì‹¤í–‰â€ì´ ì•„ë‹ˆë¼  
  **Pod/Deployment ìƒì„± ìš”ì²­(ì„ ì–¸)** ì…ë‹ˆë‹¤.

---

## 4) êµ¬í˜„ ì–¸ì–´(ì˜¤í•´ ì •ë¦¬)

- **kubectl**: Kubernetes ê³µì‹ CLI, **Go ì–¸ì–´** ê¸°ë°˜
- Docker CLI/ìƒíƒœê³„ë„ Go ì¤‘ì‹¬ ì»´í¬ë„ŒíŠ¸ê°€ ë§ìŒ
- ì¦‰, â€œkubectlì´ íŒŒì´ì¬ìœ¼ë¡œ docker runì„ ê°œì¡°í•œ ê²ƒâ€ì´ ì•„ë‹™ë‹ˆë‹¤.

---

## 5) í•œ ì¤„ ë¹„êµ

- **docker run** = ë¡œì»¬ ëŸ°íƒ€ì„ì— ì¦‰ì‹œ ì‹¤í–‰  
- **kubectl run/apply** = API Serverì— ë¦¬ì†ŒìŠ¤ ìƒì„± ìš”ì²­ â†’ ì»¨íŠ¸ë¡¤ëŸ¬/ìŠ¤ì¼€ì¤„ëŸ¬/kubeletì´ ì‹¤í–‰

---

# Kubernetes API Serverì˜ API â€œëª©ë¡â€ ë³´ëŠ” ë°©ë²•

â€œëª©ë¡â€ì€ í¬ê²Œ ë‘ ì¢…ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤.

1) **ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ ì œê³µí•˜ëŠ” ë¦¬ì†ŒìŠ¤(API ì˜¤ë¸Œì íŠ¸) ëª©ë¡**  
2) **API Serverê°€ ì‹¤ì œë¡œ ë…¸ì¶œí•˜ëŠ” HTTP ì—”ë“œí¬ì¸íŠ¸ ê²½ë¡œ(/api, /apis â€¦) ëª©ë¡**

---

## A. ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤(API ì˜¤ë¸Œì íŠ¸) ëª©ë¡ ë³´ê¸°

### 1) ì „ì²´ ë¦¬ì†ŒìŠ¤ ëª©ë¡
```sh
kubectl api-resources
```
- `pods`, `services`, `deployments` ê°™ì€ ë¦¬ì†ŒìŠ¤ ì´ë¦„
- `GROUP`(ì˜ˆ: apps), `VERSION`(ì˜ˆ: v1), `KIND`(ì˜ˆ: Deployment)
- Namespaced ì—¬ë¶€ë„ í•¨ê»˜ í‘œì‹œ

### 2) íŠ¹ì • API ê·¸ë£¹ë§Œ ë³´ê¸° (ì˜ˆ: apps)
```sh
kubectl api-resources --api-group=apps
```

### 3) ì§€ì›í•˜ëŠ” API ë²„ì „ ëª©ë¡
```sh
kubectl api-versions
```
ì˜ˆ: `v1`, `apps/v1`, `batch/v1` ë“±

---

## B. API Serverì˜ â€œì‹¤ì œ HTTP API ê²½ë¡œâ€ ëª©ë¡ ë³´ê¸°

> `kubectl get --raw`ëŠ” API Serverì— raw ìš”ì²­ì„ ë³´ë‚´ê³  JSONì„ ê·¸ëŒ€ë¡œ ë°›ìŠµë‹ˆë‹¤.

### 1) ì½”ì–´ API ë£¨íŠ¸ (legacy core)
```sh
kubectl get --raw /api
```

### CP ì—ì„œ API ì„œë²„ë¡œì„œ Swagger ë¡œ ë³´ê¸°
```sh
kubectl proxy --address='0.0.0.0' --port=8001 --accept-hosts='^.*$'
```
---
### ë‚˜ì˜ PC í˜¸ìŠ¤íŠ¸ì—ì„œ í•´ë‹¹ json ë‹¤ìš´ë¡œë“œ
![alt text](image-19.png)
---

```sh
c:\temp ë“±ì˜ ê°„ë‹¨íˆ ë””ë ‰í† ë¦¬ ìƒì„± í›„
curl.exe -s http://192.168.56.10:8001/openapi/v2 -o openapi.json
```
---

```sh
PS C:\temp> ls
    ë””ë ‰í„°ë¦¬: C:\temp
Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----      2026-01-23   ì˜¤í›„ 3:31        3543638 openapi.json
```
---
### Docker ë¡œ ì˜¬ë ¤ ë³´ê¸° - íŒŒì›Œì…¸ì—ì„œ ì‹¤í–‰
```sh
docker run --rm -p 8088:8080 `
  -e SWAGGER_JSON=/spec/openapi.json `
  -v "${PWD}\openapi.json:/spec/openapi.json:ro" `
  swaggerapi/swagger-ui
```
---
### ë‚´ PC ì—ì„œ ë„ìš´ ì»¨í…Œì´ë„ˆ ì´ë¯€ë¡œ ë¸Œë¼ìš°ì €ì—ì„œ http://127.0.0.1:8088/ ìœ¼ë¡œ ë³¼ê²ƒ. ë‹¨, ì‹¤ì‹œê°„ ë°ì´íƒ€ê°€ ì•„ë‹Œ json ì˜ íŒŒì‹± í˜•íƒœì„
![alt text](image-17.png)


### 2) API ê·¸ë£¹ ëª©ë¡
```sh
kubectl get --raw /apis
```

### 3) íŠ¹ì • ê·¸ë£¹ì˜ ë²„ì „ ë³´ê¸° (ì˜ˆ: apps)
```sh
kubectl get --raw /apis/apps
```

### 4) íŠ¹ì • ê·¸ë£¹/ë²„ì „ì˜ ë¦¬ì†ŒìŠ¤ ë³´ê¸° (ì˜ˆ: apps/v1)
```sh
kubectl get --raw /apis/apps/v1
```

ğŸ“Œ `/apis/apps/v1` ì¶œë ¥ JSONì—ëŠ” `resources` ë°°ì—´ì´ ìˆê³   
ê·¸ ì•ˆì— `deployments`, `replicasets` ë“± ë¦¬ì†ŒìŠ¤ ê²½ë¡œê°€ ë‚˜ì˜µë‹ˆë‹¤.

---

## C. OpenAPI ìŠ¤í™ìœ¼ë¡œ â€œì „ì²´ API ìŠ¤í‚¤ë§ˆâ€ ë°›ê¸°

### OpenAPI v2 ìŠ¤í‚¤ë§ˆ ì €ì¥
```sh
kubectl get --raw /openapi/v2 > openapi.json
ls -al openapi.json
```
---
```sh
ubuntu@w2:~$ kubectl get --raw /openapi/v2 > openapi.json
ubuntu@w2:~$ ls -al
total 3492
drwxr-x--- 5 ubuntu ubuntu    4096 Jan 24 06:09 .
drwxr-xr-x 3 root   root      4096 Jan  1 06:28 ..
-rw------- 1 ubuntu ubuntu     335 Jan 24 02:07 .bash_history
-rw-r--r-- 1 ubuntu ubuntu       0 Jan  6  2022 .bash_logout
-rw-r--r-- 1 ubuntu ubuntu       0 Jan  6  2022 .bashrc
drwx------ 2 ubuntu ubuntu    4096 Jan  1 06:31 .cache
drwxrwxr-x 3 ubuntu ubuntu    4096 Jan 24 05:58 .kube
-rw-r--r-- 1 ubuntu ubuntu       0 Jan  6  2022 .profile
drwx------ 2 ubuntu ubuntu    4096 Jan 24 02:42 .ssh
-rw-r--r-- 1 ubuntu ubuntu       0 Jan  3 01:44 .sudo_as_admin_successful
-rw------- 1 ubuntu ubuntu     725 Jan 24 05:54 .viminfo
-rw-rw-r-- 1 ubuntu ubuntu 3543638 Jan 24 06:09 openapi.json
```

### (ê°€ëŠ¥í•˜ë©´) OpenAPI v3 í™•ì¸
```sh
kubectl get --raw /openapi/v3 | head
```
â€» í´ëŸ¬ìŠ¤í„°/ê¶Œí•œ/ë²„ì „ì— ë”°ë¼ v3 ì œê³µ ì—¬ë¶€ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## D. kubectlì´ â€œì‹¤ì œë¡œ ì–´ë–¤ URLì„ í˜¸ì¶œí–ˆëŠ”ì§€â€ ë¡œê·¸ë¡œ ë³´ê¸°

```sh
kubectl -v=8 get pods -A
kubectl -v=8 get deploy -A
```
![alt text](image-20.png)

- ì¶œë ¥ì— `GET https://.../api/v1/...` ë˜ëŠ” `.../apis/apps/v1/...` í˜•íƒœë¡œ  
  ì‹¤ì œ í˜¸ì¶œ URL/íë¦„ì´ ë³´ì…ë‹ˆë‹¤.
- ë” ìì„¸íˆ: `-v=9`


---

### k3s í¬í•¨ â€œë‚´ í´ëŸ¬ìŠ¤í„°ì—ì„œ API ëª©ë¡ í™•ì¸â€ ì¶”ì²œ ì»¤ë§¨ë“œ ì„¸íŠ¸

### ì—°ê²° í™•ì¸
```sh
kubectl cluster-info
kubectl config view --minify
```

### ë¦¬ì†ŒìŠ¤/ë²„ì „ ëª©ë¡
```sh
kubectl api-resources
kubectl api-resources --namespaced=true
kubectl api-resources --namespaced=false
kubectl api-resources --api-group=apps
kubectl api-versions
```

### ì—”ë“œí¬ì¸íŠ¸ íŠ¸ë¦¬ í™•ì¸
```sh
kubectl get --raw /api | head
kubectl get --raw /apis | head
kubectl get --raw /apis/apps | head
kubectl get --raw /apis/apps/v1 | head
```

### ìŠ¤í‚¤ë§ˆ ì €ì¥
```sh
kubectl get --raw /openapi/v2 > openapi.json
ls -al openapi.json
```

### ì‹¤ì œ í˜¸ì¶œ URL ë³´ê¸°
```sh
kubectl -v=8 get pods -A
kubectl -v=8 get deploy -A
```

### ë¦¬ì†ŒìŠ¤ ìŠ¤í™ í•„ë“œ êµ¬ì¡° í™•ì¸
```sh
kubectl explain deployment
kubectl explain deployment.spec
kubectl explain deployment.spec.template.spec.containers
```

---

## ì°¸ê³ : â€œëª©ë¡â€ì„ ë³´ëŠ” ëª©ì ì— ë”°ë¥¸ ë¹ ë¥¸ ì„ íƒ

- **ë¦¬ì†ŒìŠ¤ íƒ€ì…(Kind) ë­ ìˆë‚˜?** â†’ `kubectl api-resources`
- **API ê·¸ë£¹/ë²„ì „ ë­ ì§€ì›í•˜ë‚˜?** â†’ `kubectl api-versions`
- **API Serverì˜ ì‹¤ì œ REST ê²½ë¡œ íŠ¸ë¦¬?** â†’ `kubectl get --raw /api`, `/apis`
- **ì „ì²´ API ìŠ¤í‚¤ë§ˆ(í•„ë“œê¹Œì§€) ë°›ê³  ì‹¶ë‹¤** â†’ `/openapi/v2`
- **kubectlì´ ì‹¤ì œë¡œ ë•Œë¦° URL ë³´ê³  ì‹¶ë‹¤** â†’ `kubectl -v=8 ...`

